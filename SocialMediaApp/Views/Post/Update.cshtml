@using EntityLayer;
@model PostGenreLocationUserModel;
@{
    ViewData["Title"] = "Update";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="card">
    <div class="card-header">
        <h2>Post Update</h2><br />
    </div>
    <div class="card-body">
        @using (Html.BeginForm("Update", "Post", FormMethod.Post, new { @class = "form-group", @enctype = "multipart/form-data" }))
        {
            @Html.TextBox("PostId",Model.PostModel.PostId,new { @class = "form-control" ,@type="hidden"})
            @Html.Label("Creator NickName")
            <select class="form-control" name="UserId">
                @foreach (var item in Model.UserModel)
                {
                    if (item.UserId == Model.PostModel.UserId)
                    {
                        <option value=" @item.UserId" selected>@item.NickName</option>
                    }
                    else
                    {
                        <option value=" @item.UserId">@item.NickName</option>
                    }
                }
            </select>
            <br />
            @Html.Label("GenerateDate")
            @Html.TextBox("GenerateDate","",new{@class="form-control",@type="date"})
            <br />
            <input id="image_file" type="file" name="imgFiles" class="form-control" accept="image/*" onchange="changeContent();" />
            @Html.ValidationMessageFor(post=>post.PostModel.imgFiles,"",new { @class ="text-danger" })
            <br />
            <div style="border:1px dashed white;padding:5px;width:30%;padding:10px;">
                <img id="imageDisplay" src="~/sliderimages/@Model.PostModel.PostContent" width="100%" height="250px" />
                <label id="imageName"></label>
                <label id="imageSize"></label>
            </div>
            <br />
            @Html.Label("Post Content")
            @Html.TextBox("PostContent","",new{@class="form-control"})
            <br />
            @Html.Label("Description")
            @Html.TextBox("Description","",new{@class="form-control"})
            <br />
            @Html.Label("Location Name")
            <select class="form-control" name="LocationId">
                @foreach (var item in Model.LocationModel)
                {
                    if (item.LocationId == Model.PostModel.LocationId)
                    {
                        <option value=" @item.LocationId" selected>@item.LocationName</option>
                    }
                    else
                    {
                        <option value=" @item.LocationId">@item.LocationName</option>
                    }
                }
            </select>
            <br />
            @Html.Label("Genre Name")
            <select class="form-control" name="GenreId">
                @foreach (var item in Model.GenreModel)
                {
                    if (item.GenreId == Model.PostModel.GenreId)
                    {
                        <option value=" @item.GenreId" selected>@item.GenreName</option>
                    }
                    else
                    {
                        <option value=" @item.GenreId">@item.GenreName</option>
                    }
                }
            </select>
            <br />
            @Html.Label("IsActive")
            <select class="form-control" name="IsActive">
                @if (Model.PostModel.IsActive)
                {
                    <option value="True" selected>Aktif</option>
                    <option value="False">Pasif</option>
                }
                else
                {
                    <option value="False" selected>Pasif</option>
                    <option value="True">Aktif</option>
                }
            </select>
            <br />
            <input id="updateBtn" class="form-control btn btn-primary" type="submit" value="Post Update" />
        }
    </div>
</div>

<!-- Script Start -->
<script>
    function changeContent() {
        var file = document.getElementById('image_file').files[0];
        //file.name == "photo.png"
        //file.type == "image/png"
        //file.size == 300821
        document.getElementById('imageDisplay').src = window.URL.createObjectURL(file);
        document.getElementById('imageName').innerHTML = file.name;
        var btn = document.getElementById('updateBtn');
        var sizeLabel = document.getElementById('imageSize');
        if (file.size > 809600) {
            sizeLabel.innerHTML = "400 kilobayttan fazla olamaz";
            sizeLabel.style.color = "red";
            btn.disabled = true;
        } else {
            sizeLabel.innerHTML = returnFileSize(file.size);
            sizeLabel.style.color = "white";
            btn.disabled = false;
        }

    }
    function returnFileSize(number) {
        if (number < 1024) {
            return `${number} bytes`;
        } else if (number >= 1024 && number < 1048576) {
            return `${(number / 1024).toFixed(1)} KB`;
        } else if (number >= 1048576) {
            return `${(number / 1048576).toFixed(1)} MB`;
        }
    }
    
</script>

